<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Virtual products | oc-mall</title>
    <meta name="generator" content="VuePress 1.5.4">
    
    <meta name="description" content="E-commerce solution for October CMS">
    <link rel="preload" href="/oc-mall-plugin/assets/css/0.styles.205e0661.css" as="style"><link rel="preload" href="/oc-mall-plugin/assets/js/app.31e620f0.js" as="script"><link rel="preload" href="/oc-mall-plugin/assets/js/2.d049ed3d.js" as="script"><link rel="preload" href="/oc-mall-plugin/assets/js/56.9de7f488.js" as="script"><link rel="prefetch" href="/oc-mall-plugin/assets/js/10.240daec6.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/11.5b6e4b72.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/12.0cb16afc.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/13.174075f7.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/14.0343cdae.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/15.da990b2b.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/16.908d9f23.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/17.11db6e80.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/18.95785ecb.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/19.f6de1fb1.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/20.b8ae6464.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/21.7a4da571.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/22.aafb3aa5.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/23.07b6ed78.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/24.a127bf7e.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/25.9e3fb448.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/26.a0ed1b56.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/27.3829f8b8.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/28.e8b27c2c.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/29.8f834986.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/3.5feaee9e.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/30.9ebcaf93.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/31.2a0badd6.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/32.c8656acb.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/33.1ce0758f.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/34.844d7a76.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/35.accdfcf7.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/36.8ceeb0d7.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/37.c05af2f2.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/38.a09ce867.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/39.f048dc3d.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/4.473465d2.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/40.c7a29560.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/41.88e23dff.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/42.8d3fcac8.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/43.940a999c.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/44.62eb4028.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/45.e380ec09.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/46.4256a7e7.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/47.82fc97bd.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/48.0ae2c909.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/49.0a933af7.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/5.7e21d5f0.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/50.815256a7.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/51.5f6a6905.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/52.abc0d0ed.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/53.52d93c68.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/54.309670e5.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/55.0fee1699.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/57.b549533f.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/58.7eff02e1.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/6.3ab0d8f1.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/7.2502c2bd.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/8.36245c75.js"><link rel="prefetch" href="/oc-mall-plugin/assets/js/9.42262f88.js">
    <link rel="stylesheet" href="/oc-mall-plugin/assets/css/0.styles.205e0661.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/oc-mall-plugin/" class="home-link router-link-active"><!----> <span class="site-name">oc-mall</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/oc-mall-plugin/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://octobercms.com/plugin/offline-mall" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Marketplace
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/OFFLINE-GmbH/oc-mall-plugin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/oc-mall-plugin/" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://octobercms.com/plugin/offline-mall" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Marketplace
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/OFFLINE-GmbH/oc-mall-plugin" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Installation</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Digging deeper</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/oc-mall-plugin/digging-deeper/properties.html" class="sidebar-link">Properties</a></li><li><a href="/oc-mall-plugin/digging-deeper/categories.html" class="sidebar-link">Categories</a></li><li><a href="/oc-mall-plugin/digging-deeper/products.html" class="sidebar-link">Products and Variants</a></li><li><a href="/oc-mall-plugin/digging-deeper/virtual-products.html" aria-current="page" class="active sidebar-link">Virtual products</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/oc-mall-plugin/digging-deeper/virtual-products.html#product-files" class="sidebar-link">Product files</a></li><li class="sidebar-sub-header"><a href="/oc-mall-plugin/digging-deeper/virtual-products.html#product-file-grants" class="sidebar-link">Product file grants</a></li><li class="sidebar-sub-header"><a href="/oc-mall-plugin/digging-deeper/virtual-products.html#generate-user-specific-product-files" class="sidebar-link">Generate user specific product files</a></li></ul></li><li><a href="/oc-mall-plugin/digging-deeper/reviews.html" class="sidebar-link">Reviews</a></li><li><a href="/oc-mall-plugin/digging-deeper/services.html" class="sidebar-link">Services</a></li><li><a href="/oc-mall-plugin/digging-deeper/currencies.html" class="sidebar-link">Currencies</a></li><li><a href="/oc-mall-plugin/digging-deeper/shipping-methods.html" class="sidebar-link">Shipping methods</a></li><li><a href="/oc-mall-plugin/digging-deeper/payments.html" class="sidebar-link">Payments</a></li><li><a href="/oc-mall-plugin/digging-deeper/taxes.html" class="sidebar-link">Taxes</a></li><li><a href="/oc-mall-plugin/digging-deeper/analytics.html" class="sidebar-link">Analytics</a></li><li><a href="/oc-mall-plugin/digging-deeper/going-live.html" class="sidebar-link">Going Live</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Development</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Changelog</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="virtual-products"><a href="#virtual-products" class="header-anchor">#</a> Virtual products</h1> <p>If a product is not something physical (like a file), you can mark it as &quot;virtual&quot;.</p> <p>Virtual products are offered to the customer as a download. After a payment
for an order with virtual products has been processed, a mail with personal download
links is sent to the customer.</p> <p>If an order consist only of virtual products, the shipping step is skipped during
checkout.</p> <p>A virtual product may consist of a file uploaded by the site admin. In this case
each customer receives the same file (for example an e-book).</p> <p>There is also the possibility to <a href="#generate-user-specific-product-files">listen for an event where a customer specific
file can be attached</a> to a virtual product (for example a generated gift card).</p> <h2 id="product-files"><a href="#product-files" class="header-anchor">#</a> Product files</h2> <p>Each virtual product can have exactly one file attached. This is the file that
is sent to the user once the product is paid.</p> <p>Newer versions of this file can be uploaded at any time. This way the user can
download the latest version of the product even after the initial purchase – given that
the download grant has not expired.</p> <p>The user can only ever download the latest file version by default.</p> <h2 id="product-file-grants"><a href="#product-file-grants" class="header-anchor">#</a> Product file grants</h2> <p>When a customer has paid for a virtual product, a
product file grant is created. The grant allows the customer to download
the purchased file for a specified number of days and a specified number of times.</p> <p>It is also possible to require the user to be logged in when the download
link is visited. If this option is not set, any visitor that knows the download link
can download the file.</p> <h2 id="generate-user-specific-product-files"><a href="#generate-user-specific-product-files" class="header-anchor">#</a> Generate user specific product files</h2> <p>You may want to generate a specific file for a customer when a virtual product is bought
(for example a personal concert ticket or a gift card).</p> <p>To do this, listen for the <code>mall.product.file_grant.created</code> event and attach your custom
file to the provided <code>ProductFileGrant</code> model.</p> <p>The easiest way to implement this feature is to create a custom plugin and register
the event in the plugin's boot method.</p> <p>You can find an example on how to generate custom gift cards below
(<a href="https://gist.github.com/tobias-kuendig/49ec99fc080fc6ba3824024f965eeafc" target="_blank" rel="noopener noreferrer">or in this gist<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>).</p> <div class="language-php line-numbers-mode"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token keyword">namespace</span> <span class="token package">OFFLINE<span class="token punctuation">\</span>MallGiftCards</span><span class="token punctuation">;</span>

<span class="token keyword">use</span> <span class="token package">Event</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">OFFLINE<span class="token punctuation">\</span>Mall<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Category</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">OFFLINE<span class="token punctuation">\</span>Mall<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Currency</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">OFFLINE<span class="token punctuation">\</span>Mall<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Discount</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">OFFLINE<span class="token punctuation">\</span>Mall<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Price</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">OFFLINE<span class="token punctuation">\</span>Mall<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>Product</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">OFFLINE<span class="token punctuation">\</span>Mall<span class="token punctuation">\</span>Models<span class="token punctuation">\</span>ProductFileGrant</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token package">System<span class="token punctuation">\</span>Classes<span class="token punctuation">\</span>PluginBase</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Plugin</span> <span class="token keyword">extends</span> <span class="token class-name">PluginBase</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">boot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">/**
         * Listen for created download grants.
         * Create a discount code, generate a gift card PDF,
         * then attach it to the grant.
         */</span>
        Event<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'mall.product.file_grant.created'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>ProductFileGrant <span class="token variable">$grant</span><span class="token punctuation">,</span> Product <span class="token variable">$product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Make sure the event is triggered by a product you care about. Validate this using the slug, the</span>
            <span class="token comment">// assigned category or one of the other unique values (user_defined_id, gtin, mpn, etc).</span>
            <span class="token comment">// In this example we check if the product belongs to a category that has the</span>
            <span class="token comment">// &quot;generate-gift-cards&quot; code set as a custom code.</span>
            <span class="token variable">$isGiftCardCategory</span> <span class="token operator">=</span> <span class="token variable">$product</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">categories</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>Category <span class="token variable">$category</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token variable">$category</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">code</span> <span class="token operator">===</span> <span class="token single-quoted-string string">'generate-gift-cards'</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Exit here if this is not a product with a gift card category attached.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span> <span class="token variable">$isGiftCardCategory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Create a new discount model.</span>
            <span class="token variable">$discount</span> <span class="token operator">=</span> Discount<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token comment">// Generate a descriptive name for the discount using the product's price information.</span>
                <span class="token single-quoted-string string">'name'</span>                 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'%s Gift Card'</span><span class="token punctuation">,</span> <span class="token variable">$product</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">price</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment">// Make sure it can only be used once.</span>
                <span class="token single-quoted-string string">'max_number_of_usages'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
                <span class="token comment">// Re-use the grant's expiry date.</span>
                <span class="token single-quoted-string string">'expires'</span>              <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$grant</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">expires_at</span><span class="token punctuation">,</span>
                <span class="token comment">// The discount is triggered by a code. The code will be created automatically on save.</span>
                <span class="token single-quoted-string string">'trigger'</span>              <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'code'</span><span class="token punctuation">,</span>
                <span class="token comment">// The discount is of a fixed amount. The amount will be defined below.</span>
                <span class="token single-quoted-string string">'type'</span>                 <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'fixed_amount'</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Set the amounts relation for each currency.</span>
            Currency<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>Currency <span class="token variable">$currency</span><span class="token punctuation">)</span> <span class="token keyword">use</span> <span class="token punctuation">(</span><span class="token variable">$discount</span><span class="token punctuation">,</span> <span class="token variable">$product</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token variable">$discount</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">amounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Price</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
                    <span class="token single-quoted-string string">'currency_id'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$currency</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">,</span>
                    <span class="token single-quoted-string string">'field'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token single-quoted-string string">'amounts'</span><span class="token punctuation">,</span>
                    <span class="token comment">// Re-use the price information form the product itself.</span>
                    <span class="token single-quoted-string string">'price'</span>       <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$product</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">price</span><span class="token punctuation">(</span><span class="token variable">$currency</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">float</span><span class="token punctuation">,</span>
                <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Generate a gift card PDF (or image). We're creating a text file here for simplicity.</span>
            <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token function">storage_path</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'app/gift_card_%s.txt'</span><span class="token punctuation">,</span> <span class="token variable">$grant</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">,</span> <span class="token single-quoted-string string">'Your coupon code is: '</span> <span class="token punctuation">.</span> <span class="token variable">$discount</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Attach the created file to the ProductFileGrant. This makes sure your custom file</span>
            <span class="token comment">// will be downloaded and not the file that is attached to the $product itself.</span>
            <span class="token variable">$grant</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">file</span> <span class="token operator">=</span> <span class="token variable">$path</span><span class="token punctuation">;</span>
            <span class="token comment">// Set a custom display name for the grant.</span>
            <span class="token variable">$grant</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">display_name</span> <span class="token operator">=</span> <span class="token variable">$discount</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token property">name</span><span class="token punctuation">;</span>
            <span class="token comment">// Don't forget to save the changes!</span>
            <span class="token variable">$grant</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/OFFLINE-GmbH/oc-mall-plugin/edit/develop/docs/digging-deeper/virtual-products.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/oc-mall-plugin/digging-deeper/products.html" class="prev">
        Products and Variants
      </a></span> <span class="next"><a href="/oc-mall-plugin/digging-deeper/reviews.html">
        Reviews
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/oc-mall-plugin/assets/js/app.31e620f0.js" defer></script><script src="/oc-mall-plugin/assets/js/2.d049ed3d.js" defer></script><script src="/oc-mall-plugin/assets/js/56.9de7f488.js" defer></script>
  </body>
</html>
